<!DOCTYPE html>
<html lang="en">
    <head>

        <title>Sam Lavery</title>

        <meta charset="utf-8">
        <title>D3 Page Template</title>
        <script type="text/javascript" src="d3/d3.v3/d3.v3.js"></script>
        <style type="text/css">

        </style>

    </head>
    <body>

        <p id="add"> + year </p>
        <p id="remove"> - year </p>
          

        <script type="text/javascript">

            //Width and Height
            var w = 500;
            var h = 250;

            //Current Year
            var dataYear = 2008;
            
            //Datasets

            var dataset2008 = [
                                {key: 1, skill: "Photoshop", level: 4},
                                {key: 2, skill: "Illustrator", level: 2},
                              ];

            var dataset2009 = [
                                {key: 1, skill: "Photoshop", level: 5},
                                {key: 2, skill: "Illustrator", level: 3},
                              ];

            var dataset2010 = [
                                {key: 1, skill: "Photoshop", level: 5},
                                {key: 2, skill: "Illustrator", level: 4},
                              ];

            var dataset2011 = [
                                {key: 1, skill: "Photoshop", level: 6},
                                {key: 2, skill: "Illustrator", level: 8},
                                {key: 3, skill: "InDesign", level: 4}
                              ];

            var dataset2012 = [
                                {key: 1, skill: "Photoshop", level: 7},
                                {key: 2, skill: "Illustrator", level: 9},
                                {key: 3, skill: "InDesign", level: 7}                                
                              ];

            var dataset2013 = [
                                {key: 1, skill: "Photoshop", level: 8},
                                {key: 2, skill: "Illustrator", level: 9},
                                {key: 3, skill: "InDesign", level: 8}  
                              ];

            //Create SVG Element

            var svg = d3.select("body")
                .append("svg")
                .attr("width", w)
                .attr("height", h);

            //Create Bars

            svg.selectAll("rect")
                .data(eval("dataset"+dataYear))
                .enter()
                .append("rect")
                //.attr("x", function(d, i) {
                //    return i * (w / dataLevel.length);
                //})
                .attr("y", function(d, i) { return i * 50; })
                .attr("width", function(d){ return d.level * w/20;})
                .attr("height",40)
                .attr("fill", "teal");

            svg.selectAll("text")
                .data(eval("dataset"+dataYear))
                .enter()
                .append("text")
                .text(function(d){
                    return d.skill;
                })
                .attr("y", function(d, i) { return (i * 50)+20; })
                .attr("font-family", "sans-serif")
                .attr("font-size", "14px")
                .attr("fill", "white");




            //On click, update with new data

            d3.selectAll("p")
                .on("click", function(){

                    //See which P was clicked

                    var paragraphID = d3.select(this).attr("id");
                    console.log(paragraphID);

                    //Decide whether to add or subtract from current year

                    if(paragraphID == "add"){
                        dataYear++;
                    }else if(paragraphID == "remove"){
                        dataYear--;
                    }

                console.log(eval("dataset"+dataYear));

            //Update Bar Data

            var bars = svg.selectAll("rect")
                .data(eval("dataset"+dataYear));

            //Enter

            bars.enter()
                .append("rect")
                .attr("y", function(d, i) { return i * 50; })
                .attr("width", function(d){ return d.level * w/20;})
                .attr("height",40)
                .attr("fill", "teal");

            //Update

            bars.transition()
                .duration(500)
                .attr("y", function(d, i) { return i * 50; })
                .attr("width", function(d){ return d.level * w/20;})
                .attr("height",40)

            //Exit

            bars.exit()
                .transition()
                .duration(500)
                .remove();

            //Update Text Data

            var newText = svg.selectAll("text")
                .data(eval("dataset"+dataYear)); 

            newText.enter()
                .append("text")
                //.attr("x",w)
                .text(function(d){
                    return d.skill;
                })
                .attr("y", function(d, i) { return (i * 50)+20; })
                .attr("font-family", "sans-serif")
                .attr("font-size", "14px")
                .attr("fill", "white");

            newText.transition()
                .duration(500)
                .attr("y", function(d, i) { return (i * 50)+20; })

            newText.exit()
                .transition()
                .duration(500)
                .remove();

            console.log(newText);                
            });
            
        </script>



    </body>
</html>